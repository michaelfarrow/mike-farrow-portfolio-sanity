---
import { decodeStegaValue, stegaClean } from '@app/lib/sanity/stega';
import Markdown from '@app/components/astro/general/markdown.astro';
import MaybeLink from '@app/components/astro/general/maybe-link.astro';
import GeneralQuote, {
  type Props as QuoteProps,
} from '@app/components/astro/general/quote.astro';
import type { CommonSchemaType } from '@app/types/content';

export type SanityQuote = CommonSchemaType<'quote'>;

export interface Props extends Omit<QuoteProps, 'cite' | ''> {
  quote: SanityQuote;
}

const {
  quote: { quote, attribution, link },
  ...rest
} = Astro.props;
---

<GeneralQuote
  data-sanity={decodeStegaValue(quote)?.replace(/\.quote/, '')}
  cite={link?.url}
  {...rest}
>
  <Markdown content={stegaClean(quote)} />
  {
    attribution && (
      <Fragment slot='attribution'>
        <MaybeLink {...link} target='_blank'>
          {stegaClean(attribution)}
        </MaybeLink>
      </Fragment>
    )
  }
</GeneralQuote>
