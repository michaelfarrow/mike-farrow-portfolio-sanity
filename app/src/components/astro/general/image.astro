---
import type { HTMLAttributes } from 'astro/types';

import { getImgProps, type ImageLoader } from '@app/lib/image';
import { Image as SolidImage } from '@app/components/solid/general/image';
import type { CommonSchemaType } from '@app/types/content';

export const QUALITY_DEFAULT = 75;

export type SanityImage = CommonSchemaType<'image'>;

export interface Props extends HTMLAttributes<'img'> {
  loader: ImageLoader;
  decorative?: boolean;
}

export type { ImageLoader } from '@app/lib/image';

const {
  class: className,
  src,
  alt,
  decorative,
  loader,
  width,
  height,
  ...rest
} = Astro.props;
---

{
  (src && (
    <SolidImage
      client:load
      data-image-component
      decoding='async'
      loading='lazy'
      class={className || undefined}
      role={decorative ? 'presentation' : undefined}
      alt={decorative ? '' : alt || undefined}
      {...getImgProps({
        sizes: rest.sizes || undefined,
        src,
        loader,
        quality: QUALITY_DEFAULT,
        width: (width && Number(width)) || undefined,
        height: (height && Number(height)) || undefined,
      })}
    />
  )) ||
    null
}
